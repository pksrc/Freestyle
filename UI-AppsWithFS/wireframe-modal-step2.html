<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publish New Version - Choose Action</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="wireframe-styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24">
                    <rect width="24" height="24" fill="#7C4DFF" rx="4"/>
                </svg>
                <span>UEM</span>
            </div>
            <select class="header-dropdown">
                <option>Product Engineering</option>
            </select>
        </div>
        <div class="header-right">
            <button class="header-btn">Add</button>
            <button class="icon-btn">üîç</button>
            <button class="icon-btn">üîî</button>
            <button class="icon-btn">‚≠ê</button>
            <button class="icon-btn">‚ùì</button>
            <div class="user-menu">pk</div>
            <button class="icon-btn">‚ãÆ‚ãÆ‚ãÆ</button>
        </div>
    </header>

    <!-- Modal Overlay -->
    <div class="modal-overlay">
        <div class="modal-dialog">
            <!-- Modal Header -->
            <div class="modal-header">
                <div>
                    <h2 class="modal-title">Review Your Selection</h2>
                    <div class="modal-subtitle">7-Zip version 23.01 ‚Üí 7 workflows affected</div>
                </div>
                <button class="modal-close" data-action="close" aria-label="Close">√ó</button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <!-- Impact Summary -->
                <div class="impact-summary">
                    <div class="impact-summary-header">Selected Action: <span id="selected-action-title">Update App Only on Devices</span></div>
                    
                    <div class="impact-stats">
                        <div class="impact-stat">
                            <div class="impact-stat-icon" id="workflow-count">7</div>
                            <div class="impact-stat-content">
                                <div class="impact-stat-label">Workflows Affected</div>
                                <div class="impact-stat-value" id="workflow-count-text">7</div>
                            </div>
                        </div>
                        <div class="impact-stat">
                            <div class="impact-stat-icon" id="device-count">7.2K</div>
                            <div class="impact-stat-content">
                                <div class="impact-stat-label">Devices to Update</div>
                                <div class="impact-stat-value">7,227</div>
                            </div>
                        </div>
                    </div>

                    <div class="impact-description">
                        <strong>What will happen:</strong>
                        <ul id="impact-details" style="margin: 8px 0 0 20px; padding: 0;">
                            <li>7-Zip will be updated to version 23.01 on approximately 7,227 devices</li>
                            <li>Workflows will remain at their current versions ‚Äî no new versions will be created</li>
                            <li>Only the app will be updated ‚Äî scripts and profiles will NOT re-run</li>
                            <li>Updates will be deployed using the app deployment flow</li>
                            <li>Devices will receive the update based on their assignment schedule</li>
                        </ul>
                    </div>
                </div>

                <div class="info-section">
                    <span class="info-icon">‚ÑπÔ∏è</span>
                    <div class="info-content">
                        <strong>Note:</strong> You can monitor the deployment status from the App Details page 
                        or the Deployment Activity dashboard after confirming.
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button class="btn btn-secondary" data-navigate="wireframe-modal-step1.html">Back</button>
                <button class="btn btn-primary" data-navigate="wireframe-modal-step2.1.html">Publish</button>
            </div>
        </div>
    </div>

    <script src="wireframe-navigation.js"></script>
    <script src="wireframe-config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Update the Publish button to use dynamic navigation
            const publishBtn = document.querySelector('[data-navigate="wireframe-modal-step2.1.html"]');
            if (publishBtn) {
                publishBtn.setAttribute('data-navigate', WireframeConfig.getSuccessPage());
            }
            
            // Get stored selections
            const selectedMethod = sessionStorage.getItem('selectedMethod');
            const selectedMethodText = sessionStorage.getItem('selectedMethodText');
            const workflowCount = sessionStorage.getItem('selectedWorkflowCount') || '7';
            const appName = sessionStorage.getItem('selectedApp') || '7-Zip';
            const version = sessionStorage.getItem('selectedVersion') || '23.01';
            
            // Update subtitle
            const subtitle = document.querySelector('.modal-subtitle');
            if (subtitle) {
                subtitle.textContent = `${appName} version ${version} ‚Üí ${workflowCount} workflows affected`;
            }
            
            // Update action title
            const actionTitle = document.getElementById('selected-action-title');
            if (actionTitle && selectedMethodText) {
                actionTitle.textContent = selectedMethodText;
            }
            
            // Update workflow counts
            document.getElementById('workflow-count').textContent = workflowCount;
            document.getElementById('workflow-count-text').textContent = workflowCount;
            
            // Define impact details for each method
            const impactDetails = {
                'publish-workflows': [
                    `${appName} will be updated to version ${version} on approximately 7,227 devices`,
                    `${workflowCount} workflow(s) will publish new versions`,
                    'The entire workflow will re-run on all assigned devices',
                    'All workflow steps including scripts, profiles, and applications will re-execute',
                    'Devices will receive updates based on their assignment schedule'
                ],
                'update-app-only': [
                    `${appName} will be updated to version ${version} on approximately 7,227 devices`,
                    'Workflows will remain at their current versions ‚Äî no new versions will be created',
                    'Only the app will be updated ‚Äî scripts and profiles will NOT re-run',
                    'Updates will be deployed using the app deployment flow',
                    'Devices will receive the update based on their assignment schedule'
                ],
                'do-nothing': [
                    `No changes will be made to workflows or devices`,
                    `Devices will remain on their current version of ${appName}`,
                    'You can manually update workflows later if needed',
                    'This flow can be triggered again from the app details page',
                    'No deployment activity will be initiated'
                ]
            };
            
            // Update impact details list
            const impactDetailsList = document.getElementById('impact-details');
            if (impactDetailsList && impactDetails[selectedMethod]) {
                impactDetailsList.innerHTML = impactDetails[selectedMethod]
                    .map(detail => `<li>${detail}</li>`)
                    .join('');
            }
        });
    </script>
</body>
</html>
